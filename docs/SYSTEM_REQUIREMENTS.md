# Системные требования

Содержание:
- Таргет-платформа и МК
- Аппаратные требования
- Пин-аут и периферия (общее)
- ПО и окружение сборки
- Память, тактирование, питание
- Надежность и условия эксплуатации
- Связь с внешним мастером и топология шины
- Тестирование и верификация
- Допущения

## Таргет-платформа и МК

- Микроконтроллер: STM32F401CCU6 (Cortex‑M4F @ до 84 МГц, 256 КБ Flash, 64 КБ SRAM).
- Проект сгенерирован STM32CubeMX/STM32CubeIDE.

## Аппаратные требования

- Интерфейс RS‑485 (рекомендуемый трансивер: MAX3485/ADM3485/аналог):
  - 120 Ω терминатор, bias‑резисторы по линии.
  - Линии A/B выведены на клеммник.
  - Управление DE/RE через GPIO.
- Альтернатива/дополнение: USB Micro/Type‑C для CDC (сервис) и/или питания.
- Датчик температуры:
  - Вариант А: NTC термистор к ADC через делитель (номиналы по схеме).
  - Вариант Б: Цифровой внешний датчик (уточнить).
- Питание: 5–24 В вход (через DC/DC), локально 3.3 В LDO/DC‑DC для МК.
- ESD/EMC: TVS по линии RS‑485 и USB, фильтрация питания.

## Пин-аут и периферия (общее)

- USARTx (RTU): TX/RX + GPIO для DE/RE (например, PA2/PA3 + PA8 — уточнить по .ioc).
- ADC1: каналы для NTC и, опционально, Vrefint/Vbat.
- TIMx: таймер периодики сенсоров; таймер протокола (межкадровые интервалы).
- USB FS (Device, CDC): D+/D− при необходимости.

Конкретика пинов определяется файлом .ioc (h-id_heater_sensor_modbus_slave_stm32f401ccu6.ioc).

## ПО и окружение сборки

- IDE: STM32CubeIDE (рекомендуемо 1.14+).
- Компилятор: arm-none-eabi-gcc (C11), newlib-nano.
- HAL: STM32CubeF4.
- RTOS: отсутствует (superloop + ISR/DMA).
- Настройка проекта хранится в .ioc (CubeMX).

## Память, тактирование, питание

- Тактирование: HSI/HSE → PLL → SYSCLK 84 МГц (уточнить по .ioc).
- Flash потребление: < 60 КБ (оценка), RAM: < 16 КБ (оценка).
- Энергопитание: 3.3 В, средний ток < 50 мА (без нагрузки периферии).
- IWDG активен в релизных сборках.

## Надежность и условия эксплуатации

- Температурный диапазон: −20…+70 °C (уточнить).
- Влажность: до 95% без конденсации.
- Устойчивость к помехам на линии RS‑485, защита от ESD/EMC.

## Связь с внешним мастером и топология шины

- Совместимость с dobord/h-id_heater_control_modbus_master_stm32f401ccu6:
  - Параметры по умолчанию: 9600/19200 бод, 8N1 (настраиваются).
  - Адрес ведомого: 1..247; на шине может быть до ~32 устройств.
  - Требования к таймингам RTU: соблюдение t1.5/t3.5; T_response см. PRD.
  - Повторы (retry) при таймаутах: операции записи должны быть идемпотентны.
- Топология RS‑485:
  - Два терминатора 120 Ω по концам магистрали, корректный bias.
  - Кабель витая пара, длина согласно требованиям RS‑485 и скорости линии.

## Тестирование и верификация

- Юнит‑тесты для CRC и парсинга PDU (на хосте/эмуляции).
- Интеграционные тесты Modbus с Modbus Poll/RTU Master и с dobord/h-id_heater_control_modbus_master_stm32f401ccu6.
- Стендовые испытания на устойчивость/помехозащищенность.
- Верификация времени ответа при разных скоростях UART.

## Допущения

- Основной транспорт — Modbus RTU (RS‑485). USB CDC используется для сервиса.
- Параметры пинмапа и периферии — как в .ioc.
- Конкретный датчик/цепь NTC — уточняются схемой.
